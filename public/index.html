<html>
  <head>
    <script src='http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js'></script>
    <script src="./vendor/codemirror2/lib/codemirror.js" type="text/javascript"></script>
    <link rel="stylesheet" href="./vendor/codemirror2/lib/codemirror.css">
    <script src="./vendor/codemirror2/mode/ruby/ruby.js"></script>
    <style>
      body{
        background-color: #eee;
      }
      div.CodeMirror{
        background-color: white;
      }
    </style>

    <script>
      $(document).ready(function(){
        function debug(str){ $("#debug").append("<p>"+str+"</p>"); };

        ws = new WebSocket("ws://localhost:8123");
        ws.onmessage = function(evt) {
          console.log(evt);
          data = $.parseJSON(evt.data);
          escaped_response = $('<div />').text(data.content.data).html();
          $("#msg").append("<pre>"+escaped_response+"</pre>");
        };
        ws.onclose = function() { debug("socket closed"); };
        ws.onopen = function() {
          debug("connected...");
        };
      });
    </script>
  </head>
  <body>
    <div id="debug"></div>
    <div id='code1'></div>
    <button id='submit'>run</button>
    <div id="msg"></div>

    <script>
      var textarea = document.getElementById('code1');
      var codeMirrorOptions = {
        mode: "ruby"
      }

      //then create the editor
      var editor = CodeMirror.fromTextArea(textarea, codeMirrorOptions);

      $('#submit').on('click', function(){ ws.send(editor.getValue()) })

    </script>
  </body>
</html>
